## 四个响应消息头

* HTTP缓存发生在第二次请求，第一次没有缓存的
* Expires 存放一份**绝对的时间**，表示资源失效时间。缺点就是，用户可以改时间。是属于http1.0的
* Cache-Control  max-age字段 存放**相对时间**，就是存放的有效期，这就比较好了。属于http1.1
* Etag 上次请求内容的**hash值**
* Last-Modified 文件**上一次被修改的时间**

## 强缓存和协商缓存

### 强缓存

- 浏览器在请求资源时，会先根据本地缓存中的header中的信息，判断是否命中强缓存，如果命中，则直接从内存中读取，返回304状态码，不会向服务器发送请求。

- 强缓存就是缓存还没有过期，通过Expire、Cache-Control来判断是否过期
- 同时启用**cache-control**优先级高

### 协商缓存

- 强缓存过期了，浏览器会发送一个请求到服务器，我们就进行协商缓存，其实就是通过一些策略来看看新的内容和旧的是否一样，如果一样就返回304，从内容读取
- 先看看是否有**Etag**,如果有就把Etag的值以一个叫做IF-None-Match的请求消息头发给服务器进行决策。

> Etag：根据文件内容通过MD5加密生成一个hash值。

- -  浏览器第一次请求一个a.js，服务器返回a.js的同时，在响应头信息中加上Etag。Etag保证每个资源时唯一的，资源变化会导致Etag变化。
  -  浏览器第二次请求a.js，请求头中会包含if-none-match（也就是之前接受到的Etag），服务器收到if-none-match，与自己的Etag进行比较。
  - 如果相同，返回304
- 没有Etag就看看有没有**Last-Modified**,以IF-Modified-since消息头传给服务器，服务器比较一下，如果文件的上次修改时间相同，就表示文件没有修改，这次的内容和上次的一致，你直接用上次的返回304，否则返回200
- **Last-Modified 与 ETag 是可以一起使用的，服务器会优先验证 ETag，一致的情况下，才会继续比对 Last-Modified，最后才决定是否返回 304。** 